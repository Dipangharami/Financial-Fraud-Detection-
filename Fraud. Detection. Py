# Financial Fraud Detection System

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report, confusion_matrix, accuracy_score

# Load Dataset
data = pd.read_csv("dataset/creditcard.csv")

print("Dataset Shape:", data.shape)
print(data.head())

# Check missing values
print("\nMissing Values:\n", data.isnull().sum())

# Fraud vs Normal
print("\nClass Distribution:\n", data['Class'].value_counts())

# Visualization
sns.countplot(x='Class', data=data)
plt.title("Fraud vs Genuine Transactions")
plt.show()

# Amount distribution
plt.figure(figsize=(6,4))
sns.histplot(data['Amount'], bins=50)
plt.title("Transaction Amount Distribution")
plt.show()

# Feature Scaling
scaler = StandardScaler()
data['Amount'] = scaler.fit_transform(data[['Amount']])

# Split features and target
X = data.drop('Class', axis=1)
y = data['Class']

# Train-test split
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.3, random_state=42, stratify=y
)

# ---------------- Logistic Regression ----------------
lr = LogisticRegression(max_iter=1000)
lr.fit(X_train, y_train)

y_pred_lr = lr.predict(X_test)

print("\nLogistic Regression Results")
print("Accuracy:", accuracy_score(y_test, y_pred_lr))
print(confusion_matrix(y_test, y_pred_lr))
print(classification_report(y_test, y_pred_lr))

# ---------------- Random Forest ----------------
rf = RandomForestClassifier(n_estimators=100, random_state=42)
rf.fit(X_train, y_train)

y_pred_rf = rf.predict(X_test)

print("\nRandom Forest Results")
print("Accuracy:", accuracy_score(y_test, y_pred_rf))
print(confusion_matrix(y_test, y_pred_rf))
print(classification_report(y_test, y_pred_rf))

# Sample Prediction
sample = X_test.iloc[0:1]
prediction = rf.predict(sample)

if prediction[0] == 1:
    print("\n⚠ Fraudulent Transaction Detected")
else:
    print("\n✅ Genuine Transaction")
